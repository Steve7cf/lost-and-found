<div class="container">
  <h1 class="h4 fw-bold mb-4"><i class="bi bi-grid me-2"></i>Browse Lost & Found</h1>

  <form action="/posts" method="get" class="card border-0 shadow-sm rounded-3 p-3 mb-4">
    <div class="row g-2 align-items-end">
      <div class="col-md-4">
        <label class="form-label small text-muted">Search</label>
        <input type="search" name="q" class="form-control" placeholder="Item, category, location…" value="<%= typeof query !== 'undefined' ? query : '' %>">
      </div>
      <div class="col-md-2">
        <label class="form-label small text-muted">Type</label>
        <select name="type" class="form-select">
          <option value="">All</option>
          <option value="lost" <%= typeFilter === 'lost' ? 'selected' : '' %>>Lost</option>
          <option value="found" <%= typeFilter === 'found' ? 'selected' : '' %>>Found</option>
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label small text-muted">Category</label>
        <select name="category" class="form-select">
          <option value="">All</option>
          <% if (typeof categories !== 'undefined' && categories.length) { categories.forEach(function(c) { %>
          <option value="<%= c %>" <%= categoryFilter === c ? 'selected' : '' %>><%= c %></option>
          <% }); } %>
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label small text-muted">Status</label>
        <select name="status" class="form-select">
          <option value="open" <%= statusFilter === 'open' ? 'selected' : '' %>>Open</option>
          <option value="resolved" <%= statusFilter === 'resolved' ? 'selected' : '' %>>Resolved</option>
          <option value="closed" <%= statusFilter === 'closed' ? 'selected' : '' %>>Closed</option>
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label small text-muted">Sort</label>
        <select name="sort" class="form-select">
          <option value="newest" <%= sort === 'newest' ? 'selected' : '' %>>Newest</option>
          <option value="oldest" <%= sort === 'oldest' ? 'selected' : '' %>>Oldest</option>
          <option value="relevance" <%= sort === 'relevance' ? 'selected' : '' %>>Relevance</option>
        </select>
      </div>
      <div class="col-12 col-md-6 col-lg-2">
        <button type="submit" class="btn btn-primary w-100"><i class="bi bi-search me-1"></i>Apply</button>
      </div>
    </div>
    <input type="hidden" name="page" value="1">
  </form>

  <p class="text-muted small mb-3"><%= total %> result(s)</p>

  <% if (posts && posts.length) { %>
  <div class="row g-3">
    <% posts.forEach(function(p) { %>
    <div class="col-sm-6 col-lg-4 col-xl-3">
      <a href="/posts/<%= p._id %>" class="text-decoration-none">
        <div class="card h-100 shadow-sm border-0 rounded-3 overflow-hidden post-card">
          <div class="position-relative bg-light" style="height: 160px;">
            <% if (p.images && p.images[0]) { %>
            <img src="<%= p.images[0] %>" class="card-img-top object-fit-cover w-100 h-100" alt="">
            <% } else { %>
            <div class="d-flex align-items-center justify-content-center h-100 text-muted"><i class="bi bi-image display-4"></i></div>
            <% } %>
            <span class="position-absolute top-0 start-0 badge bg-<%= p.type === 'lost' ? 'warning' : 'success' %> text-dark m-2"><%= p.type %></span>
            <span class="position-absolute top-0 end-0 badge bg-secondary m-2"><%= p.status %></span>
          </div>
          <div class="card-body">
            <h2 class="card-title h6 text-truncate"><%= p.title %></h2>
            <p class="card-text small text-muted mb-0"><%= p.category %><% if (p.location) { %> · <%= p.location %><% } %></p>
          </div>
        </div>
      </a>
    </div>
    <% }); %>
  </div>

  <% if (totalPages > 1) { %>
  <nav class="mt-4" aria-label="Page navigation">
    <ul class="pagination justify-content-center flex-wrap">
      <% if (page > 1) { %>
      <li class="page-item"><a class="page-link" href="/posts?page=<%= page - 1 %><%= query ? '&q=' + encodeURIComponent(query) : '' %><%= typeFilter ? '&type=' + typeFilter : '' %><%= categoryFilter ? '&category=' + encodeURIComponent(categoryFilter) : '' %>&status=<%= statusFilter %>&sort=<%= sort %>">Previous</a></li>
      <% } %>
      <li class="page-item disabled"><span class="page-link">Page <%= page %> of <%= totalPages %></span></li>
      <% if (page < totalPages) { %>
      <li class="page-item"><a class="page-link" href="/posts?page=<%= page + 1 %><%= query ? '&q=' + encodeURIComponent(query) : '' %><%= typeFilter ? '&type=' + typeFilter : '' %><%= categoryFilter ? '&category=' + encodeURIComponent(categoryFilter) : '' %>&status=<%= statusFilter %>&sort=<%= sort %>">Next</a></li>
      <% } %>
    </ul>
  </nav>
  <% } %>
  <% } else { %>
  <div class="text-center py-5 text-muted">
    <i class="bi bi-inbox display-4"></i>
    <p class="mt-2 mb-0">No posts match your filters.</p>
    <a href="/posts" class="btn btn-outline-primary mt-2">Clear filters</a>
  </div>
  <% } %>
</div>
