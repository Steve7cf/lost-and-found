<div class="container py-4">
  <div class="row">
    <div class="col-lg-4 mb-4">
      <div class="card border-0 shadow-sm rounded-3 overflow-hidden">
        <div class="card-body text-center p-4">
          <% if (profileUser.photo) { %>
          <img src="<%= profileUser.photo %>" alt="" class="rounded-circle mb-3" width="120" height="120" style="object-fit: cover;">
          <% } else { %>
          <div class="rounded-circle bg-primary bg-opacity-25 d-inline-flex align-items-center justify-content-center mb-3" style="width:120px;height:120px;"><i class="bi bi-person display-1 text-primary"></i></div>
          <% } %>
          <h1 class="h5 fw-bold mb-1"><%= profileUser.fullName %></h1>
          <p class="text-body-secondary small mb-1"><%= profileUser.regNumber %></p>
          <% if (profileUser.degreeLevel) { %><p class="text-body-secondary small mb-0"><%= degreeLabels[profileUser.degreeLevel] || profileUser.degreeLevel %></p><% } %>
          <p class="text-body-secondary small mb-0"><%= profileUser.course %><% if (profileUser.yearOfStudy) { %> · <%= profileUser.yearOfStudy %><% } %></p>
          <% if (typeof profileUser.profileViews === 'number') { %>
          <p class="small text-body-secondary mt-2 mb-0"><i class="bi bi-eye me-1"></i><%= profileUser.profileViews %> profile view<%= profileUser.profileViews !== 1 ? 's' : '' %></p>
          <% } %>
          <% if (avgRating !== null) { %>
          <p class="small mb-0 mt-1"><i class="bi bi-star-fill text-warning"></i> <%= avgRating %> (<%= ratingCount %> rating<%= ratingCount !== 1 ? 's' : '' %>)</p>
          <% } %>
          <% if (profileUser.about) { %>
          <div class="text-start mt-3 pt-3 border-top"><p class="small text-body-secondary mb-0"><%= profileUser.about %></p></div>
          <% } %>
          <% if (user && user._id && String(profileUser._id) !== String(user._id)) { %>
          <form action="/profile/<%= profileUser._id %>/rate" method="post" class="mt-3">
            <label class="form-label small">Rate this contributor</label>
            <div class="d-flex justify-content-center gap-1 flex-wrap">
              <% for (var i = 1; i <= 5; i++) { %>
              <button type="submit" name="value" value="<%= i %>" class="btn btn-sm <%= myRating === i ? 'btn-warning' : 'btn-outline-secondary' %>"><i class="bi bi-star-fill"></i> <%= i %></button>
              <% } %>
            </div>
          </form>
          <% } %>
        </div>
      </div>
    </div>
    <div class="col-lg-8">
      <h2 class="h5 fw-bold mb-3">Their posts</h2>
      <% if (posts && posts.length) { %>
      <div class="list-group list-group-flush border rounded-3 shadow-sm">
        <% posts.forEach(function(p) { %>
        <a href="/posts/<%= p._id %>" class="list-group-item list-group-item-action d-flex gap-3 align-items-center">
          <% if (p.images && p.images[0]) { %>
          <img src="<%= p.images[0] %>" alt="" width="64" height="64" class="rounded object-fit-cover flex-shrink-0">
          <% } else { %>
          <div class="rounded bg-light d-flex align-items-center justify-content-center flex-shrink-0" style="width:64px;height:64px;"><i class="bi bi-image text-muted"></i></div>
          <% } %>
          <div class="flex-grow-1 min-width-0">
            <div class="fw-semibold text-truncate"><%= p.title %></div>
            <div class="small text-body-secondary"><%= p.type %> · <%= p.category %></div>
          </div>
        </a>
        <% }); %>
      </div>
      <% } else { %>
      <p class="text-body-secondary">No public posts yet.</p>
      <% } %>
    </div>
  </div>
</div>
